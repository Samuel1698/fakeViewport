!function(){"use strict";var t=[,function(t,e,n){n.r(e),n.d(e,{fetchAndDisplayLogs:function(){return s},initLogs:function(){return r}});var a=n(2);let o=10;async function s(t){const e=document.getElementById("logCount"),n=document.getElementById("logLimit"),s=document.getElementById("logOutput"),r=void 0!==t?t:o,d=Math.max(10,Math.min(600,parseInt(r)||10));o=d,n.value=d,e.textContent=d;const i=await(0,a.fetchJSON)(`/api/logs?limit=${d}`);i?.data?.logs&&(s.textContent=i.data.logs.join(""))}function r(){const t=document.getElementById("searchLogs"),e=document.getElementById("logLimit");document.querySelectorAll(".custom-spinner-btn").forEach((t=>{t.addEventListener("click",(()=>{const n=parseInt(e.step)||10;let a=parseInt(e.value)||o;a="increment"===t.dataset.action?Math.min(600,a+n):Math.max(10,a-n),e.value=a,e.dispatchEvent(new Event("input"))}))})),t.addEventListener("click",(async()=>{await s(e.value)})),e.addEventListener("keypress",(async t=>{"Enter"===t.key&&await s(e.value)})),e.addEventListener("blur",(()=>{let t=parseInt(e.value)||o;t=Math.max(10,Math.min(600,t)),e.value=t,document.getElementById("logCount").textContent=t,o=t})),e.addEventListener("input",(()=>{let t=parseInt(e.value)||o;document.getElementById("logCount").textContent=Math.min(600,t)}));const n=document.getElementById("expandLogs"),a=document.getElementById("logs");n&&a&&n.addEventListener("click",(()=>{a.classList.toggle("expanded");const t=a.classList.contains("expanded");n.setAttribute("aria-expanded",t),n.setAttribute("aria-label",t?"Collapse logs":"Expand logs"),n.addEventListener("keydown",(t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),n.click())}))})),s(o)}},function(t,e,n){n.r(e),n.d(e,{fetchJSON:function(){return r},loadInfo:function(){return u},loadInfoData:function(){return l},loadStatus:function(){return c},setActiveTab:function(){return m}});var a=n(3);let o=null,s="status";async function r(t){try{const e=await fetch(t);return e.ok?await e.json():null}catch{return null}}function d(t){const e=Math.floor(t/86400),n=Math.floor(t%86400/3600),a=Math.floor(t%3600/60),o=Math.floor(t%60),s=[];return e>0&&s.push(`${e}d`),n>0&&s.push(`${n}h`),a>0&&s.push(`${a}m`),o>0&&s.push(`${o}s`),s.length>0?s.join(" "):"0s"}const i=new Intl.DateTimeFormat("en-US",{month:"short",day:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1});async function c(){const t=await r("/api/script_uptime"),e=document.getElementById("scriptUptime");if(t?.data&&"number"==typeof t.data.script_uptime){const n=t.data.script_uptime;e.classList.remove("Green","Red"),null!==o&&n===o?(e.textContent="Not Running",e.classList.add("Red")):(e.textContent=d(n),e.classList.add("Green")),o=n}else e.textContent="Not Running",e.classList.add("Red"),o=null;const n=await r("/api/system_uptime");n?.data&&(document.getElementById("systemUptime").textContent=d(n.data.system_uptime));const a=await r("/api/status");if(a?.data){const t=document.getElementById("statusMsg");t.textContent=a.data.status,t.classList.remove("Green","Blue","Red"),t.textContent.includes("Healthy")||t.textContent.includes("Resumed")||t.textContent.includes("restart")||t.textContent.includes("Fullscreen")||t.textContent.includes("Saved")?t.classList.add("Green"):t.textContent.includes("Stopped")||t.textContent.includes("Killed")||t.textContent.includes("Restarting")||t.textContent.includes("Loaded")||t.textContent.includes("Crashed")||t.textContent.includes("Retrying")||t.textContent.includes("Starting")?t.classList.add("Blue"):(t.textContent.includes("Error")||t.textContent.includes("stuck")||t.textContent.includes("Unsupported")||t.textContent.includes("Timed")||t.textContent.includes("Issue")||t.textContent.includes("Couldn't")||t.textContent.includes("Paused")||t.textContent.includes("Offline")||t.textContent.includes("unresponsive")||t.textContent.includes("Not Found")||t.textContent.includes("Error"))&&t.classList.add("Red")}const s=await r("/api/ram");if(s?.data){const t=(s.data.ram_used/1024**3).toFixed(1),e=(s.data.ram_total/1024**3).toFixed(1),n=document.getElementById("ram"),a=s.data.ram_used/s.data.ram_total*100;n.textContent=`${t} GiB / ${e} GiB`,n.classList.remove("Green","Yellow","Red"),a<=35?n.classList.add("Green"):a<=60?n.classList.add("Yellow"):n.classList.add("Red")}}async function l(){try{const{current:t,latest:e}=await(0,a.loadUpdateData)(),n=document.getElementById("version"),o=function(t,e){const n=t.split(".").map(Number),a=e.split(".").map(Number);return a[0]>n[0]?"major":a[1]>n[1]?"minor":a[2]>n[2]?"patch":"current"}(t,e);switch(n.textContent=`${t}`,n.classList.remove("Green","Yellow","Red"),o){case"current":default:n.classList.add("Green");break;case"patch":n.classList.add("Yellow");break;case"minor":case"major":n.classList.add("Red")}}catch(t){versionElement.textContent="Version info unavailable",versionElement.classList.remove("Green","Yellow","Red"),console.error("Failed to load version info:",t)}const t=await r("/api/next_restart"),e=document.getElementById("scheduledRestart");if(t?.data?.next_restart){const n=new Date(t.data.next_restart),a=new Date,o=(n.getTime()-a.getTime())/36e5;e.textContent=i.format(n).replace(/, /g," "),e.classList.remove("Yellow","Green","Red"),o<=1&&e.classList.add("Yellow"),e.parentElement.removeAttribute("hidden")}else e.parentElement.setAttribute("hidden","");const n=await r("/api/health_interval");if(n?.data){const t=Math.round(n.data.health_interval_sec/60);document.getElementById("healthInterval").textContent=`${t} min`}const o=await r("/api/log_interval");o?.data&&(document.getElementById("logInterval").textContent=`${o.data.log_interval_min} min`)}async function u(){"status"===s?await c():"info"===s&&await l()}function m(t){s=t,"status"===s&&u()}},function(t,e,n){n.r(e),n.d(e,{CACHE_TTL:function(){return o},applyUpdate:function(){return c},checkForUpdate:function(){return l},initUpdateButton:function(){return u},loadUpdateData:function(){return d},showChangelog:function(){return i}});var a=n(2);const o=9e5;let s={timestamp:0,data:null};function r(t,e){const n=t.split(".").map(Number),a=e.split(".").map(Number);for(let t=0,e=Math.max(n.length,a.length);t<e;t++){const e=n[t]||0,o=a[t]||0;if(e>o)return 1;if(e<o)return-1}return 0}async function d(){const t=Date.now();if(s.data&&t-s.timestamp<o)return s.data;const[e,n]=await Promise.all([(0,a.fetchJSON)("/api/update"),fetch("/api/update/changelog").then((t=>t.json()))]);if(!e?.data)throw new Error("Failed to fetch version info");if("ok"!==n.status)throw new Error("Failed to fetch changelog");const{current:r,latest:d}=e.data,{changelog:i,release_url:c}=n.data;return s={timestamp:t,data:{current:r,latest:d,changelog:i,releaseUrl:c}},s.data}function i(){const t=s.data;if(!t)return void console.error("No update data; did you call checkForUpdate()?");const{latest:e,changelog:n,releaseUrl:a}=t,o=document.querySelector("#update .container h2");e.includes("failed-to-fetch")?o.textContent="Failed to Fetch Changelog":o.textContent=`Release v${e}`,document.getElementById("changelog-body").innerHTML=marked.parse(n),document.getElementById("changelog-link").href=a,document.getElementById("update").removeAttribute("hidden")}async function c(t){const e=document.querySelector("#updateMessage span"),n=t.querySelector("span").textContent,a=t.disabled;e.textContent="",e.className="",t.disabled=!0,e.textContent="Fetching Update...",e.classList.add("Green");try{const{current:o,latest:s}=await d();if(r(s,o)<=0)return e.textContent="✓ Your system is already up to date",e.classList.add("Green"),t.querySelector("span").textContent="Up to date",t.disabled=!0,void setTimeout((()=>{e.textContent="",e.className=""}),5e3);e.textContent="Fetching Update...",e.classList.add("Green");const i=await fetch("/api/update/apply",{method:"POST"});if(!i.ok)throw new Error(`Update failed with status ${i.status}`);const c=await i.json(),l=c?.data?.outcome||c?.outcome;if("already-current"===l)return e.textContent="✓ Your system is already up to date",e.classList.remove("Red"),e.classList.add("Green"),t.querySelector("span").textContent="Up to date",void setTimeout((()=>{t.querySelector("span").textContent=n,t.disabled=a,e.textContent="",e.className=""}),1e4);if(!l.startsWith("updated-to-"))throw"update-failed"===l?new Error("Update process failed"):new Error("Unexpected update response");e.textContent="✓ Update successful, preparing to restart...",e.classList.remove("Red"),e.classList.add("Green");try{const[n,a]=await Promise.all([fetch("/api/control/restart",{method:"POST"}),fetch("/api/self/restart",{method:"POST"})]);if(!n.ok||!a.ok)throw new Error("Restart commands failed");const[o,s]=await Promise.all([n.json(),a.json()]);"ok"===o.status&&"ok"===s.status?(e.textContent="✓ System restarting...",setTimeout((()=>location.reload()),5e3)):(e.textContent="✓ Update complete - please restart manually",t.querySelector("span").textContent="Restart required")}catch(n){e.textContent="✓ Update complete - automatic restart failed",t.querySelector("span").textContent="Restart required",console.error("Restart failed:",n)}}catch(n){console.error("Update failed:",n),e.classList.remove("Green"),e.classList.add("Red"),n.message.includes("Failed to fetch")?e.textContent="✗ Network error - please check your connection":n.message.includes("Update process failed")?e.textContent="✗ Update failed - please try again":e.textContent="✗ Update error - please check logs",t.querySelector("span").textContent="Retry",t.disabled=!1}}async function l(){try{const{current:t,latest:e}=await d(),n=document.getElementById("updateBtn"),a=document.querySelector('#update button[type="submit"]');if(r(e,t)<=0)return n&&n.setAttribute("hidden",""),void(a&&(a.disabled=!0,a.querySelector("span").textContent="Up to date"));n&&n.removeAttribute("hidden"),a&&(a.disabled=!1,a.querySelector("span").textContent="Apply Update")}catch(t){console.error("Update check failed:",t)}}function u(){const t=document.querySelector('#update button[type="submit"]');t&&(t.addEventListener("click",(()=>c(t))),t.disabled=!0,t.querySelector("span").textContent="Checking...")}},function(t,e,n){n.r(e),n.d(e,{control:function(){return o}});var a=n(2);async function o(t,e){e.setAttribute("disabled",""),setTimeout((()=>{e.removeAttribute("disabled")}),5e3);const n=document.querySelectorAll(".statusMessage span");n.forEach((t=>{t.textContent="",t.classList.remove("Green","Red")}));try{const e=await fetch(`/api/control/${t}`,{method:"POST"}),o=await e.json();"ok"===o.status?n.forEach((t=>{t.textContent="✓ "+o.message,t.classList.add("Green")})):n.forEach((t=>{t.textContent="✗ "+o.message,t.classList.add("Red")})),await(0,a.loadInfo)(),setTimeout((()=>{n.forEach((t=>{t.textContent="",t.classList.remove("Green","Red")}))}),5e3),setTimeout(a.loadInfo,5e3)}catch(t){n.forEach((e=>{e.textContent="✗ "+t,e.classList.add("Red")}))}}},function(t,e,n){n.r(e),n.d(e,{buttons:function(){return d},initSections:function(){return c},sections:function(){return r},toggleSection:function(){return i}});var a=n(1),o=n(2),s=n(3);const r={status:document.getElementById("status"),info:document.getElementById("info"),logs:document.getElementById("logs"),updateBanner:document.getElementById("update")},d={status:document.getElementById("statusBtn"),info:document.getElementById("infoBtn"),logs:document.getElementById("logsBtn"),updateBanner:document.getElementById("updateBtn"),refreshButton:document.getElementById("refreshButton")};function i(t){Object.values(r).forEach((t=>{t.setAttribute("hidden","")})),r[t].removeAttribute("hidden"),Object.entries(d).forEach((([e,n])=>{n.setAttribute("aria-selected",e===t?"true":"false")})),"status"===t||"info"===t?d.refreshButton.removeAttribute("hidden"):d.refreshButton.setAttribute("hidden","true")}function c(){r.status.removeAttribute("hidden"),r.info.setAttribute("hidden",""),r.logs.setAttribute("hidden",""),r.updateBanner.setAttribute("hidden",""),d.status.setAttribute("aria-selected","true"),d.info.removeAttribute("aria-selected"),d.logs.removeAttribute("aria-selected"),d.updateBanner.removeAttribute("aria-selected"),d.refreshButton.removeAttribute("hidden"),d.status.addEventListener("click",(()=>{i("status"),(0,o.setActiveTab)("status")})),d.info.addEventListener("click",(()=>{i("info"),(0,o.setActiveTab)("info")})),d.logs.addEventListener("click",(async()=>{i("logs"),await(0,a.fetchAndDisplayLogs)()})),d.updateBanner.addEventListener("click",(()=>{i("updateBanner"),(0,s.showChangelog)()})),d.refreshButton.addEventListener("click",(()=>{(0,o.loadInfo)(),d.refreshButton.classList.add("refreshing"),setTimeout((()=>{d.refreshButton.classList.remove("refreshing")}),1e3)}))}}],e={};function n(a){var o=e[a];if(void 0!==o)return o.exports;var s=e[a]={exports:{}};return t[a](s,s.exports,n),s.exports}n.d=function(t,e){for(var a in e)n.o(e,a)&&!n.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var a={};!function(){n.r(a);var t=n(1),e=n(2),o=n(3),s=n(4),r=n(5);let d,i;document.addEventListener("DOMContentLoaded",(async()=>{(0,e.setActiveTab)("status"),await Promise.all([(0,e.loadStatus)(),(0,e.loadInfoData)()]),(0,o.checkForUpdate)(),(0,o.initUpdateButton)(),(0,t.initLogs)(),(0,r.initSections)(),d=setInterval((()=>{!1===document.getElementById("status").hasAttribute("hidden")&&(0,e.loadInfo)()}),15e3),i=setInterval((()=>{!1===document.getElementById("info").hasAttribute("hidden")&&(0,e.loadInfo)()}),o.CACHE_TTL),setInterval(o.checkForUpdate,o.CACHE_TTL),document.querySelectorAll(".controls button").forEach((t=>{t.addEventListener("click",(()=>{(0,s.control)(t.dataset.action,t)}))}))}))}()}();