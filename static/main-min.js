let lastScriptUptime=null;function formatDuration(t){const e=Math.floor(t/86400),a=Math.floor(t%86400/3600),n=Math.floor(t%3600/60),o=Math.floor(t%60),s=[];return e>0&&s.push(`${e}d`),a>0&&s.push(`${a}h`),n>0&&s.push(`${n}m`),o>0&&s.push(`${o}s`),s.length>0?s.join(" "):"0s"}async function loadInfo(){async function t(t){try{const e=await fetch(t);return e.ok?await e.json():null}catch{return null}}const e=await t("/api/script_uptime"),a=document.getElementById("scriptUptime");if(e?.data&&"number"==typeof e.data.script_uptime){const t=e.data.script_uptime;a.textContent=null!==lastScriptUptime&&t===lastScriptUptime?"Not Running":formatDuration(t),lastScriptUptime=t}else a.textContent="Not Running",lastScriptUptime=null;const n=await t("/api/system_uptime");n?.data&&(document.getElementById("systemUptime").textContent=formatDuration(n.data.system_uptime));const o=await t("/api/ram");if(o?.data){const t=(o.data.ram_used/1024**3).toFixed(1),e=(o.data.ram_total/1024**3).toFixed(1);document.getElementById("ram").textContent=`${t} GiB / ${e} GiB`}const s=await t("/api/health_interval");if(s?.data){const t=Math.round(s.data.health_interval_sec/60);document.getElementById("healthInterval").textContent=`${t} min`}const i=await t("/api/log_interval");i?.data&&(document.getElementById("logInterval").textContent=`${i.data.log_interval_min} min`);const l=await t("/api/status");l?.data&&(document.getElementById("statusMsg").textContent=l.data.status);const r=await t("/api/log_entry");r?.data&&(document.getElementById("logEntry").textContent=r.data.log_entry)}async function control(t,e){e.setAttribute("disabled",""),setTimeout((()=>{e.removeAttribute("disabled")}),15e3);const a=document.querySelector("#statusMessage span");a.textContent="",a.style.color="";try{const e=await fetch(`/api/control/${t}`,{method:"POST"}),n=await e.json();"ok"===n.status?(a.textContent="✓ "+n.message,a.style.color="green"):(a.textContent="✗ "+n.message,a.style.color="red"),await loadInfo(),setTimeout((()=>{a.textContent="",a.style.color=""}),15e3),setTimeout(loadInfo,15e3)}catch(t){a.textContent="✗ "+t,a.style.color="red"}}document.addEventListener("DOMContentLoaded",(()=>{loadInfo(),setInterval(loadInfo,6e4)}));