function formatDuration(t){const e=Math.floor(t/86400),n=Math.floor(t%86400/3600),o=Math.floor(t%3600/60),a=Math.floor(t%60),l=[];return e>0&&l.push(`${e}d`),n>0&&l.push(`${n}h`),o>0&&l.push(`${o}m`),a>0&&l.push(`${a}s`),l.length>0?l.join(" "):"0s"}async function loadInfo(){const t={"X-API-KEY":localStorage.getItem("viewport_api_key")};async function e(e){try{const n=await fetch(e,{headers:t});return n.ok?await n.json():null}catch{return null}}const n=await e("/api/script_uptime");n?.data&&(document.getElementById("scriptUptime").textContent=formatDuration(n.data.script_uptime));const o=await e("/api/system_uptime");o?.data&&(document.getElementById("systemUptime").textContent=formatDuration(o.data.system_uptime));const a=await e("/api/ram");if(a?.data){const t=(a.data.ram_used/1024**3).toFixed(1),e=(a.data.ram_total/1024**3).toFixed(1);document.getElementById("ram").textContent=`${t} GiB / ${e} GiB`}const l=await e("/api/health_interval");if(l?.data){const t=Math.round(l.data.health_interval_sec/60);document.getElementById("healthInterval").textContent=`${t} min`}const s=await e("/api/log_interval");s?.data&&(document.getElementById("logInterval").textContent=`${s.data.log_interval_min} min`);const d=await e("/api/status");d?.data&&(document.getElementById("statusMsg").textContent=d.data.status);const i=await e("/api/log_entry");i?.data&&(document.getElementById("logEntry").textContent=i.data.log_entry)}async function control(t){const e=document.getElementById("statusMessage");e.textContent="";const n=localStorage.getItem("viewport_api_key");if(!n)return e.textContent="✗ No API key saved",void(e.style.color="red");try{const o=await fetch(`/api/control/${t}`,{method:"POST",headers:{"X-API-KEY":n}}),a=await o.json();"ok"===a.status?(e.textContent="✓ "+a.message,e.style.color="green"):(e.textContent="✗ "+a.message,e.style.color="red")}catch(t){e.textContent="✗ "+t,e.style.color="red"}}document.addEventListener("DOMContentLoaded",(()=>{if(CONTROL_TOKEN){localStorage.getItem("viewport_api_key")&&(document.getElementById("login").style.display="none",document.getElementById("controls").style.display="block",document.getElementById("info").style.display="block",loadInfo()),document.getElementById("saveKey").addEventListener("click",(()=>{const t=document.getElementById("apiKeyInput").value.trim();t?(localStorage.setItem("viewport_api_key",t),document.getElementById("login").style.display="none",document.getElementById("controls").style.display="block",document.getElementById("info").style.display="block",loadInfo()):alert("API key cannot be empty")}))}else document.getElementById("login").style.display="none",document.getElementById("controls").style.display="block",document.getElementById("info").style.display="block",loadInfo();setInterval((()=>{"block"===document.getElementById("info").style.display&&loadInfo()}),6e4)}));