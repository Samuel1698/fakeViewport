let lastScriptUptime=null;function formatDuration(t){const e=Math.floor(t/86400),a=Math.floor(t%86400/3600),n=Math.floor(t%3600/60),o=Math.floor(t%60),i=[];return e>0&&i.push(`${e}d`),a>0&&i.push(`${a}h`),n>0&&i.push(`${n}m`),o>0&&i.push(`${o}s`),i.length>0?i.join(" "):"0s"}async function loadInfo(){async function t(t){try{const e=await fetch(t);return e.ok?await e.json():null}catch{return null}}const e=await t("/api/script_uptime"),a=document.getElementById("scriptUptime");if(e?.data&&"number"==typeof e.data.script_uptime){const t=e.data.script_uptime;a.textContent=null!==lastScriptUptime&&t===lastScriptUptime?"Not Running":formatDuration(t),lastScriptUptime=t}else a.textContent="Not Running",lastScriptUptime=null;const n=await t("/api/system_uptime");n?.data&&(document.getElementById("systemUptime").textContent=formatDuration(n.data.system_uptime));const o=await t("/api/ram");if(o?.data){const t=(o.data.ram_used/1024**3).toFixed(1),e=(o.data.ram_total/1024**3).toFixed(1);document.getElementById("ram").textContent=`${t} GiB / ${e} GiB`}const i=await t("/api/health_interval");if(i?.data){const t=Math.round(i.data.health_interval_sec/60);document.getElementById("healthInterval").textContent=`${t} min`}const s=await t("/api/log_interval");s?.data&&(document.getElementById("logInterval").textContent=`${s.data.log_interval_min} min`);const l=await t("/api/status");l?.data&&(document.getElementById("statusMsg").textContent=l.data.status);const r=await t("/api/log_entry");r?.data&&(document.getElementById("logEntry").textContent=r.data.log_entry)}async function control(t){const e=document.querySelector("#statusMessage span");e.textContent="";if(!localStorage.getItem("viewport_api_key"))return e.textContent="✗ No API key saved",void(e.style.color="red");try{const a=await fetch(`/api/control/${t}`,{method:"POST"}),n=await a.json();"ok"===n.status?(e.textContent="✓ "+n.message,e.style.color="green"):(e.textContent="✗ "+n.message,e.style.color="red")}catch(t){e.textContent="✗ "+t,e.style.color="red"}}document.addEventListener("DOMContentLoaded",(()=>{loadInfo(),setInterval(loadInfo,6e4)}));