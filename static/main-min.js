!function(){"use strict";var t=[,function(t,e,n){n.r(e),n.d(e,{fetchAndDisplayLogs:function(){return o},initLogs:function(){return d}});var a=n(2);let s=10;async function o(t){const e=document.getElementById("logCount"),n=document.getElementById("logLimit"),o=document.getElementById("logOutput"),d=void 0!==t?t:s,i=Math.max(10,Math.min(600,parseInt(d)||10));s=i,n.value=i,e.textContent=i;const r=await(0,a.fetchJSON)(`/api/logs?limit=${i}`);r?.data?.logs&&(o.innerHTML="",r.data.logs.forEach((t=>{const e=document.createElement("div");e.textContent=t,e.classList.add("log-entry");const n=t.toLowerCase();(n.includes("healthy")||n.includes("resumed")||n.includes("restart")||n.includes("fullscreen")||n.includes("saved")||n.includes("already running")||n.includes("started"))&&e.classList.add("Green"),(n.includes("stopped")||n.includes("stopping")||n.includes("killed")||n.includes("attempting")||n.includes("restarting")||n.includes("loaded")||n.includes("crashed")||n.includes("retrying")||n.includes("checking")||n.includes("log-in")||n.includes("starting"))&&(e.classList.remove("Green"),e.classList.add("Blue")),(n.includes("=====")||n.includes("driver")||n.includes("deleted")||n.includes("get "))&&(e.classList.remove("Green","Blue"),e.classList.add("Yellow")),(n.includes("error")||n.includes("stuck")||n.includes("unsupported")||n.includes("timed")||n.includes("issue")||n.includes("couldn't")||n.includes("paused")||n.includes("offline")||n.includes("unresponsive")||n.includes("[error]")||n.includes(", line")||n.includes("traceback")||n.includes("not found"))&&(e.classList.remove("Green","Blue","Yellow"),e.classList.add("Red")),o.appendChild(e)})))}function d(){const t=document.getElementById("searchLogs"),e=document.getElementById("logLimit");document.querySelectorAll(".custom-spinner-btn").forEach((t=>{t.addEventListener("click",(()=>{const n=parseInt(e.step)||10;let a=parseInt(e.value)||s;a="increment"===t.dataset.action?Math.min(600,a+n):Math.max(10,a-n),e.value=a,e.dispatchEvent(new Event("input"))}))})),t.addEventListener("click",(async()=>{await o(e.value)})),e.addEventListener("keypress",(async t=>{"Enter"===t.key&&await o(e.value)})),e.addEventListener("blur",(()=>{let t=parseInt(e.value)||s;t=Math.max(10,Math.min(600,t)),e.value=t,document.getElementById("logCount").textContent=t,s=t})),e.addEventListener("input",(()=>{let t=parseInt(e.value)||s;document.getElementById("logCount").textContent=Math.min(600,t)}));const n=document.getElementById("expandLogs"),a=document.getElementById("logs");n&&a&&n.addEventListener("click",(()=>{a.classList.toggle("expanded");const t=a.classList.contains("expanded");n.setAttribute("aria-expanded",t),n.setAttribute("aria-label",t?"Collapse logs":"Expand logs"),n.addEventListener("keydown",(t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),n.click())}))})),o(s)}},function(t,e,n){n.r(e),n.d(e,{fetchJSON:function(){return d},loadDeviceData:function(){return m},loadInfo:function(){return g},loadStatus:function(){return u},setActiveTab:function(){return p}});var a=n(3);let s=null,o="status";async function d(t){try{const e=await fetch(t);return e.ok?await e.json():null}catch{return null}}let i={data:null,lastUpdated:0,ttl:36e5,async get(t=!1){const e=Date.now();return(t||!this.data||e-this.lastUpdated>this.ttl)&&(this.data=await d("/api/config"),this.lastUpdated=e,this.updateConfigElements()),this.data},updateConfigElements(){if(!this.data?.data)return;const t=this.data.data,e=t?.general?.health_interval_sec?Math.round(t.general.health_interval_sec/60):null,n=(t,e)=>{const n=`${t} Second${1!==t?"s":""}`;return"waitTime"===e.id&&t<=5?e.classList.add("Red"):e.classList.add("Blue"),n},a=(t,n)=>{const a=`${t} Minute${1!==t?"s":""}`;return"healthInterval"===n.id&&t<=1?n.classList.add("Red"):"logInterval"===n.id&&e&&t<e?n.classList.add("Yellow"):n.classList.add("Blue"),a},s=(t,e)=>{const n=`${t} Day${1!==t?"s":""}`;return t>7?e.classList.add("Yellow"):e.classList.add("Blue"),n},o=(t,e)=>{const n=t?"Yes":"No";return"headless"===e.id&&t?e.classList.add("Red"):"logFile"===e.id&&!t||"logConsole"===e.id&&!t||"errorLogging"===e.id&&t||"debugLogging"===e.id&&t||"screenshots"===e.id&&t?e.classList.add("Yellow"):e.classList.add("Blue"),n};[{id:"healthInterval",path:"general.health_interval_sec",format:(t,e)=>a(Math.round(t/60),e)},{id:"waitTime",path:"general.wait_time_sec",format:(t,e)=>n(t,e)},{id:"maxRetries",path:"general.max_retries",format:(t,e)=>(e.classList.add(t<3?"Red":"Blue"),`${t} Attempts`)},{id:"restartTimes",path:"general.restart_times",format:(t,e)=>(e.classList.add("Yellow"),Array.isArray(t)?t.join(", "):"-")},{id:"scheduledRestart",path:"general.next_restart",format:(t,e)=>{if(!t)return e.parentElement?.setAttribute("hidden",""),"-";const n=new Date(t),a=new Date,s=(n.getTime()-a.getTime())/36e5;return e.classList.remove("Yellow","Green","Red"),s<=1&&e.classList.add("Yellow"),e.parentElement?.removeAttribute("hidden"),l.format(n).replace(/, /g," ")}},{id:"profilePath",path:"browser.profile_path",format:(t,e)=>{if(!t)return e.classList.remove("Green","Red"),"-";const n=t.toLowerCase(),a=n.includes("chrome")||n.includes("chromium")||n.includes("firefox");return e.classList.add(a?"Green":"Red"),t}},{id:"profileBinary",path:"browser.binary_path",format:(t,e)=>{if(!t)return e.classList.remove("Green","Red"),"-";const n=t.toLowerCase(),a=n.includes("chrome")||n.includes("chromium")||n.includes("firefox");return e.classList.add(a?"Green":"Red"),t}},{id:"headless",path:"browser.headless",format:(t,e)=>o(t,e)},{id:"logFile",path:"logging.log_file_flag",format:(t,e)=>o(t,e)},{id:"logConsole",path:"logging.log_console_flag",format:(t,e)=>o(t,e)},{id:"debugLogging",path:"logging.debug_logging",format:(t,e)=>o(t,e)},{id:"errorLogging",path:"logging.error_logging",format:(t,e)=>o(t,e)},{id:"screenshots",path:"logging.ERROR_PRTSCR",format:(t,e)=>o(t,e)},{id:"logDays",path:"logging.log_days",format:(t,e)=>s(t,e)},{id:"logInterval",path:"logging.log_interval_min",format:(t,e)=>a(t,e)}].forEach((({id:e,path:n,format:a})=>{const s=document.getElementById(e);if(!s)return;s.classList.remove("Blue","Yellow","Red");const o=n.split(".").reduce(((t,e)=>t?.[e]),t);null!=o?s.textContent=a?a(o,s):o.toString():(s.textContent="-",s.classList.add("Blue"))}))}};function r(t){const e=Math.floor(t/86400),n=Math.floor(t%86400/3600),a=Math.floor(t%3600/60),s=Math.floor(t%60),o=[];return e>0&&o.push(`${e}d`),n>0&&o.push(`${n}h`),a>0&&o.push(`${a}m`),s>0&&o.push(`${s}s`),o.length>0?o.join(" "):"0s"}const l=new Intl.DateTimeFormat("en-US",{month:"short",day:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1});function c(t){return t<1024?`${t.toFixed(1)} B/s`:t<1048576?`${(t/1024).toFixed(1)} KB/s`:`${(t/1048576).toFixed(1)} MB/s`}async function u(t=!1){const[e,n,a,o]=await Promise.all([d("/api/script_uptime"),d("/api/status"),d("/api/system_info"),d("/api/logs?limit=1")]),l=document.getElementById("scriptUptime");if(e?.data&&"number"==typeof e.data.script_uptime){const t=e.data.script_uptime;l.classList.remove("Green","Red"),null!==s&&t===s?(l.textContent="Not Running",l.classList.add("Red")):(l.textContent=r(t),l.classList.add("Green")),s=t}else l.textContent="Not Running",l.classList.add("Red"),s=null;const u=document.getElementById("statusMsg");if(n?.data&&u&&(u.textContent=n.data.status,u.classList.remove("Green","Blue","Red"),u.textContent.includes("Healthy")||u.textContent.includes("Resumed")||u.textContent.includes("restart")||u.textContent.includes("Fullscreen")||u.textContent.includes("Saved")?u.classList.add("Green"):u.textContent.includes("Stopped")||u.textContent.includes("Killed")||u.textContent.includes("Restarting")||u.textContent.includes("Loaded")||u.textContent.includes("Crashed")||u.textContent.includes("Retrying")||u.textContent.includes("Starting")?u.classList.add("Blue"):(u.textContent.includes("Error")||u.textContent.includes("stuck")||u.textContent.includes("Unsupported")||u.textContent.includes("Timed")||u.textContent.includes("Issue")||u.textContent.includes("Couldn't")||u.textContent.includes("Paused")||u.textContent.includes("Offline")||u.textContent.includes("unresponsive")||u.textContent.includes("Not Found")||u.textContent.includes("Error"))&&u.classList.add("Red")),a?.data){const t=document.getElementById("systemUptime");t&&(t.textContent=r(a.data.system_uptime));const e=document.getElementById("up"),n=document.getElementById("down");if(a?.data?.network?.primary_interface){const t=a.data.network.primary_interface,s=c(t.upload),o=c(t.download);e.textContent=s,n.textContent=o}}if(o?.data?.logs&&o.data.logs.length>0){const t=document.getElementById("logEntry"),e=o.data.logs[0].trim();t.textContent=e,t.classList.remove("Green","Blue","Red"),e.includes("[ERROR]")?t.classList.add("Red"):e.includes("[WARN]")?t.classList.add("Yellow"):e.includes("[DEBUG]")?t.classList.add("Blue"):(e.includes("[INFO]"),t.classList.add("Green"))}await i.get(t)}async function m(){try{const{current:t,latest:e}=await(0,a.loadUpdateData)(),n=document.getElementById("version"),s=function(t,e){const n=t.split(".").map(Number),a=e.split(".").map(Number);return a[0]>n[0]?"major":a[1]>n[1]?"minor":a[2]>n[2]?"patch":"current"}(t,e);switch(n.textContent=`${t}`,n.classList.remove("Green","Yellow","Red"),s){case"current":default:n.classList.add("Green");break;case"patch":n.classList.add("Yellow");break;case"minor":case"major":n.classList.add("Red")}}catch(t){console.error("Failed to load version info:",t)}const t=await d("/api/system_info");if(t?.data){const e=document.getElementById("osInfo"),n=document.getElementById("hardwareInfo"),a=document.getElementById("cpuInfo"),s=document.getElementById("ramInfo"),o=document.getElementById("diskInfo");if(e&&(e.textContent=t.data.os_name),n&&(n.textContent=t.data.hardware_model),t?.data?.disk_available&&(o.textContent=t.data.disk_available,o.classList.remove("Green","Yellow","Red"),t.data.disk_bytes<209715200?o.classList.add("Red"):t.data.disk_bytes<1073741824?o.classList.add("Yellow"):o.classList.add("Green")),t?.data?.cpu?.percent){const e=t.data.cpu.percent;a.textContent=`${e}%`,a.classList.remove("Green","Yellow","Red"),e<=35?a.classList.add("Green"):e<=60?a.classList.add("Yellow"):a.classList.add("Red")}if(t?.data?.memory?.percent){const e=(t.data.memory.used/1024**3).toFixed(1),n=(t.data.memory.total/1024**3).toFixed(1),a=t.data.memory.percent;s.textContent=`${e} GiB / ${n} GiB`,s.classList.remove("Green","Yellow","Red"),a<=35?s.classList.add("Green"):a<=60?s.classList.add("Yellow"):s.classList.add("Red")}}}async function g(t={}){const{forceRefreshConfig:e=!1}=t;"status"===o?await u(e):"device"===o?await m():"config"===o&&await i.get(e)}function p(t){o=t,"status"===o&&g()}},function(t,e,n){n.r(e),n.d(e,{CACHE_TTL:function(){return s},applyUpdate:function(){return l},checkForUpdate:function(){return c},initUpdateButton:function(){return u},loadUpdateData:function(){return i},showChangelog:function(){return r}});var a=n(2);const s=9e5;let o={timestamp:0,data:null};function d(t,e){const n=t.split(".").map(Number),a=e.split(".").map(Number);for(let t=0,e=Math.max(n.length,a.length);t<e;t++){const e=n[t]||0,s=a[t]||0;if(e>s)return 1;if(e<s)return-1}return 0}async function i(){const t=Date.now();if(o.data&&t-o.timestamp<s)return o.data;const[e,n]=await Promise.all([(0,a.fetchJSON)("/api/update"),fetch("/api/update/changelog").then((t=>t.json()))]);if(!e?.data)throw new Error("Failed to fetch version info");if("ok"!==n.status)throw new Error("Failed to fetch changelog");const{current:d,latest:i}=e.data,{changelog:r,release_url:l}=n.data;return o={timestamp:t,data:{current:d,latest:i,changelog:r,releaseUrl:l}},o.data}function r(){const t=o.data;if(!t)return void console.error("No update data; did you call checkForUpdate()?");const{latest:e,changelog:n,releaseUrl:a}=t,s=document.querySelector("#update .container h2");e.includes("failed-to-fetch")?s.textContent="Failed to Fetch Changelog":s.textContent=`Release v${e}`,document.getElementById("changelog-body").innerHTML=marked.parse(n),document.getElementById("changelog-link").href=a,document.getElementById("update").removeAttribute("hidden")}async function l(t){const e=document.querySelector("#updateMessage span"),n=t.querySelector("span").textContent,a=t.disabled;e.textContent="",e.className="",t.disabled=!0,e.textContent="Fetching Update...",e.classList.add("Green");try{const{current:s,latest:o}=await i();if(d(o,s)<=0)return e.textContent="✓ Your system is already up to date",e.classList.add("Green"),t.querySelector("span").textContent="Up to date",t.disabled=!0,void setTimeout((()=>{e.textContent="",e.className=""}),5e3);e.textContent="Fetching Update...",e.classList.add("Green");const r=await fetch("/api/update/apply",{method:"POST"});if(!r.ok)throw new Error(`Update failed with status ${r.status}`);const l=await r.json(),c=l?.data?.outcome||l?.outcome;if("already-current"===c)return e.textContent="✓ Your system is already up to date",e.classList.remove("Red"),e.classList.add("Green"),t.querySelector("span").textContent="Up to date",void setTimeout((()=>{t.querySelector("span").textContent=n,t.disabled=a,e.textContent="",e.className=""}),1e4);if(!c.startsWith("updated-to-"))throw"update-failed"===c?new Error("Update process failed"):new Error("Unexpected update response");e.textContent="✓ Update successful, preparing to restart...",e.classList.remove("Red"),e.classList.add("Green");try{const[n,a]=await Promise.all([fetch("/api/control/restart",{method:"POST"}),fetch("/api/self/restart",{method:"POST"})]);if(!n.ok||!a.ok)throw new Error("Restart commands failed");const[s,o]=await Promise.all([n.json(),a.json()]);"ok"===s.status&&"ok"===o.status?(e.textContent="✓ System restarting...",setTimeout((()=>location.reload()),5e3)):(e.textContent="✓ Update complete - please restart manually",t.querySelector("span").textContent="Restart required")}catch(n){e.textContent="✓ Update complete - automatic restart failed",t.querySelector("span").textContent="Restart required",console.error("Restart failed:",n)}}catch(n){console.error("Update failed:",n),e.classList.remove("Green"),e.classList.add("Red"),n.message.includes("Failed to fetch")?e.textContent="✗ Network error - please check your connection":n.message.includes("Update process failed")?e.textContent="✗ Update failed - please try again":e.textContent="✗ Update error - please check logs",t.querySelector("span").textContent="Retry",t.disabled=!1}}async function c(){try{const{current:t,latest:e}=await i(),n=document.getElementById("updateBtn"),a=document.querySelector('#update button[type="submit"]');if(d(e,t)<=0)return n&&n.setAttribute("hidden",""),void(a&&(a.disabled=!0,a.querySelector("span").textContent="Up to date"));n&&n.removeAttribute("hidden"),a&&(a.disabled=!1,a.querySelector("span").textContent="Apply Update")}catch(t){console.error("Update check failed:",t)}}function u(){const t=document.querySelector('#update button[type="submit"]');t&&(t.addEventListener("click",(()=>l(t))),t.disabled=!0,t.querySelector("span").textContent="Checking...")}},function(t,e,n){n.r(e),n.d(e,{control:function(){return s}});var a=n(2);async function s(t){const e=document.querySelectorAll(".statusMessage span");e.forEach((t=>{t.textContent="",t.classList.remove("Green","Red")}));try{const n=await fetch(`/api/control/${t}`,{method:"POST"}),s=await n.json();"ok"===s.status?e.forEach((t=>{t.textContent="✓ "+s.message,t.classList.add("Green")})):e.forEach((t=>{t.textContent="✗ "+s.message,t.classList.add("Red")})),await(0,a.loadInfo)(),setTimeout((()=>{e.forEach((t=>{t.textContent="",t.classList.remove("Green","Red")}))}),5e3),setTimeout(a.loadInfo,5e3)}catch(t){e.forEach((e=>{e.textContent="✗ "+t,e.classList.add("Red")}))}}},function(t,e,n){n.r(e),n.d(e,{buttons:function(){return i},initSections:function(){return l},sections:function(){return d},toggleSection:function(){return r}});var a=n(1),s=n(2),o=n(3);const d={status:document.getElementById("status"),device:document.getElementById("device"),config:document.getElementById("config"),logs:document.getElementById("logs"),updateBanner:document.getElementById("update")},i={status:document.getElementById("statusBtn"),device:document.getElementById("deviceBtn"),config:document.getElementById("configBtn"),logs:document.getElementById("logsBtn"),updateBanner:document.getElementById("updateBtn"),refreshButton:document.getElementById("refreshButton"),logInput:document.querySelector("#navigation .log-controls")};function r(t){Object.values(d).forEach((t=>{t.setAttribute("hidden","")})),d[t].removeAttribute("hidden"),Object.entries(i).forEach((([e,n])=>{n.setAttribute("aria-selected",e===t?"true":"false")})),"status"===t||"device"===t||"config"===t?i.refreshButton.removeAttribute("hidden"):i.refreshButton.setAttribute("hidden","true"),"logs"===t?i.logInput.removeAttribute("hidden"):i.logInput.setAttribute("hidden","true")}function l(){d.status.removeAttribute("hidden"),d.device.setAttribute("hidden",""),d.logs.setAttribute("hidden",""),d.updateBanner.setAttribute("hidden",""),i.status.setAttribute("aria-selected","true"),i.device.removeAttribute("aria-selected"),i.logs.removeAttribute("aria-selected"),i.updateBanner.removeAttribute("aria-selected"),i.refreshButton.removeAttribute("hidden"),i.status.addEventListener("click",(()=>{r("status"),(0,s.setActiveTab)("status")})),i.device.addEventListener("click",(()=>{r("device"),(0,s.setActiveTab)("device")})),i.config.addEventListener("click",(()=>{r("config"),(0,s.setActiveTab)("config")})),i.logs.addEventListener("click",(async()=>{r("logs"),await(0,a.fetchAndDisplayLogs)()})),i.updateBanner.addEventListener("click",(()=>{r("updateBanner"),(0,o.showChangelog)()})),i.refreshButton.addEventListener("click",(()=>{loadDevice({forceRefreshConfig:!0}),i.refreshButton.classList.add("refreshing"),setTimeout((()=>{i.refreshButton.classList.remove("refreshing")}),1e3)}))}}],e={};function n(a){var s=e[a];if(void 0!==s)return s.exports;var o=e[a]={exports:{}};return t[a](o,o.exports,n),o.exports}n.d=function(t,e){for(var a in e)n.o(e,a)&&!n.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var a={};!function(){n.r(a);var t=n(1),e=n(2),s=n(3),o=n(4),d=n(5);let i,r,l;document.addEventListener("DOMContentLoaded",(async()=>{if(document.querySelectorAll("[data-tooltip]").forEach((t=>{const e=t.getAttribute("data-tooltip").split("|").map((t=>t.trim())).filter(Boolean),n=document.createElement("div");if(n.className="tooltip-text",n.setAttribute("role","tooltip"),e.length>0){const t=document.createElement("span");t.className="Blue",t.textContent=e[0],n.appendChild(t)}for(let t=1;t<e.length;t++){n.appendChild(document.createElement("br"));const a=document.createElement("span");a.textContent=e[t],t==e.length-1&&e.length>2&&(a.className="Yellow"),n.appendChild(a)}1===e.length&&(n.querySelector(".Blue").style.display="block");const a=document.createElement("span");a.className="tooltip",t.parentNode.insertBefore(a,t),t.classList.add("tooltip-trigger"),t.setAttribute("tabindex","-1"),t.setAttribute("aria-describedby",`tooltip-${Date.now()}`),n.id=t.getAttribute("aria-describedby"),a.appendChild(t),a.appendChild(n),t.addEventListener("touchstart",(e=>{e.preventDefault(),document.querySelectorAll(".tooltip-trigger").forEach((e=>{e!==t&&e.classList.remove("active")})),t.classList.toggle("active")}))})),document.addEventListener("touchstart",(t=>{t.target.closest(".tooltip-trigger")||document.querySelectorAll(".tooltip-trigger").forEach((t=>{t.classList.remove("active")}))})),document.getElementById("themeToggle").addEventListener("click",(()=>{const t=document.documentElement,e="light"===t.getAttribute("data-theme")?"dark":"light";t.setAttribute("data-theme",e),localStorage.setItem("theme",e)})),"undefined"!=typeof window){const t=localStorage.getItem("theme");t&&document.documentElement.setAttribute("data-theme",t)}if(window.location.pathname.includes("login.html")||"/login"===window.location.pathname||document.getElementById("login"))return;(0,e.setActiveTab)("status"),(0,d.initSections)(),await Promise.all([(0,e.loadStatus)(),(0,e.loadDeviceData)()]),(0,t.initLogs)(),(0,s.checkForUpdate)(),(0,s.initUpdateButton)(),i=setInterval((()=>{!1===document.getElementById("status").hasAttribute("hidden")&&(0,e.loadInfo)()}),5e3),r=setInterval((()=>{!1===document.getElementById("device").hasAttribute("hidden")&&(0,e.loadInfo)()}),5e3),l=setInterval((()=>{!1===document.getElementById("config").hasAttribute("hidden")&&(0,e.loadInfo)()}),s.CACHE_TTL),setInterval(s.checkForUpdate,s.CACHE_TTL);const n=document.querySelector(".controls"),a=n.parentElement,c=n.querySelectorAll("button"),u=n.getAttribute("data-tooltip");c.forEach((t=>{t.addEventListener("click",(async()=>{c.forEach((t=>{t.setAttribute("disabled",""),t.classList.add("processing")})),n.setAttribute("data-tooltip","Processing command..."),a.classList.add("show");try{await(0,o.control)(t.dataset.action,t)}catch(t){console.error("Control action failed:",t),n.setAttribute("data-tooltip","Action failed. "+(t.message||""))}finally{setTimeout((()=>{c.forEach((t=>{t.removeAttribute("disabled"),t.classList.remove("processing")})),a.classList.remove("show"),n.setAttribute("data-tooltip",u)}),15e3)}}))}))}))}()}();