let lastScriptUptime=null;function formatDuration(t){const e=Math.floor(t/86400),n=Math.floor(t%86400/3600),a=Math.floor(t%3600/60),o=Math.floor(t%60),i=[];return e>0&&i.push(`${e}d`),n>0&&i.push(`${n}h`),a>0&&i.push(`${a}m`),o>0&&i.push(`${o}s`),i.length>0?i.join(" "):"0s"}document.addEventListener("DOMContentLoaded",(()=>{loadInfo(),setInterval(loadInfo,6e4)}));const formatter=new Intl.DateTimeFormat("en-US",{month:"short",day:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1});async function fetchJSON(t){try{const e=await fetch(t);return e.ok?await e.json():null}catch{return null}}async function loadInfo(){const t=await fetchJSON("/api/script_uptime"),e=document.getElementById("scriptUptime");if(t?.data&&"number"==typeof t.data.script_uptime){const n=t.data.script_uptime;e.textContent=null!==lastScriptUptime&&n===lastScriptUptime?"Not Running":formatDuration(n),lastScriptUptime=n}else e.textContent="Not Running",lastScriptUptime=null;const n=await fetchJSON("/api/system_uptime");n?.data&&(document.getElementById("systemUptime").textContent=formatDuration(n.data.system_uptime));const a=await fetchJSON("/api/ram");if(a?.data){const t=(a.data.ram_used/1024**3).toFixed(1),e=(a.data.ram_total/1024**3).toFixed(1);document.getElementById("ram").textContent=`${t} GiB / ${e} GiB`}const o=await fetchJSON("/api/health_interval");if(o?.data){const t=Math.round(o.data.health_interval_sec/60);document.getElementById("healthInterval").textContent=`${t} min`}const i=await fetchJSON("/api/log_interval");i?.data&&(document.getElementById("logInterval").textContent=`${i.data.log_interval_min} min`);const s=await fetchJSON("/api/status");s?.data&&(document.getElementById("statusMsg").textContent=s.data.status);const d=await fetchJSON("/api/log_entry");d?.data&&(document.getElementById("logEntry").textContent=d.data.log_entry);const l=await fetchJSON("/api/next_restart"),r=document.getElementById("scheduledRestart");if(l?.data?.next_restart){const t=new Date(l.data.next_restart);r.textContent=formatter.format(t).replace(/, /g," "),r.parentElement.removeAttribute("hidden")}else r.parentElement.setAttribute("hidden","")}async function control(t,e){e.setAttribute("disabled",""),setTimeout((()=>{e.removeAttribute("disabled")}),15e3);const n=document.querySelector("#statusMessage span");n.textContent="",n.style.color="";try{const e=await fetch(`/api/control/${t}`,{method:"POST"}),a=await e.json();"ok"===a.status?(n.textContent="✓ "+a.message,n.style.color="green"):(n.textContent="✗ "+a.message,n.style.color="red"),await loadInfo(),setTimeout((()=>{n.textContent="",n.style.color=""}),15e3),setTimeout(loadInfo,15e3)}catch(t){n.textContent="✗ "+t,n.style.color="red"}}const logsBtn=document.getElementById("showLogsBtn"),modal=document.getElementById("logsModal"),closeX=document.getElementById("closeLogs"),output=document.getElementById("logOutput");logsBtn.addEventListener("click",(async()=>{const t=await fetchJSON("/api/logs?limit=100");t?.data?.logs?(output.textContent=t.data.logs.join(""),modal.removeAttribute("hidden")):modal.setAttribute("hidden","")})),closeX.addEventListener("click",(()=>modal.setAttribute("hidden",""))),modal.addEventListener("click",(t=>{t.target===modal&&modal.setAttribute("hidden","")}));